import { useEffect, useState } from "react";
import { connect } from 'react-redux';
import { changeTrack } from '../../actions';
import { Link } from "react-router-dom";
import TextBoldL from '../text/text-bold-l';
import PlayButton from '../buttons/play-button';
import { useSwipeable } from 'react-swipeable';

import styles from "./playlist-card-g.module.css";

function PlaylistCardG(props){
    const[isthisplay, setIsthisPlay] = useState(false)
    const[currentImageIndex, setCurrentImageIndex] = useState(0)

    const images = [props.data.imgUrl, props.data.imgUrlB, props.data.imgUrlC];

    const handlers = useSwipeable({
        onSwipedLeft: () => setCurrentImageIndex((currentImageIndex + 1) % images.length),
        onSwipedRight: () => setCurrentImageIndex((currentImageIndex - 1 + images.length) % images.length),
        preventDefaultTouchmoveEvent: true,
        trackMouse: true
    });

    function changeTheme(){
        document.documentElement.style.setProperty('--hover-home-bg', props.data.hoverColor);
    }

    useEffect(() => {
		setIsthisPlay(parseInt(props.data.index) === props.trackData.trackKey[0])
	})

    return (
        <div className={styles.PlaylistCardGBox} {...handlers}>
            <Link to={`/playlist/${props.data.link}`} onMouseOver={changeTheme}>
                <div className={styles.PlaylistCardG}>
                    <div className={styles.ImgBox}>
                        <img src={images[currentImageIndex]} alt={`${props.data.title}`} />
                        <div style={{position: 'absolute', display: 'flex', bottom: '.5rem', left: '5px'}}> {/* AÃ±ade una capa absoluta para los indicadores */}
                            {images.map((image, index) => (
                                <div
                                    key={index}
                                    style={{
                                        position: 'relative',
                                        display: 'flex',
                                        height: '10px',
                                        width: '4px',
                                        backgroundColor: index === currentImageIndex ? '#066eff' : '#999',
                                        margin: '2px',
                                        borderRadius: '1px'
                                    }}
                                />
                            ))}
                        </div>

                    </div>

                    <div className={styles.Title}>
                        <TextBoldL>{props.data.title}</TextBoldL>
                    </div>

                    <div className={styles.Tag}>
                        <img src={props.data.artistImgUrl} alt={`${props.data.title}`} />
                    </div>

                </div>
            </Link>
            <div
                onClick={() => props.changeTrack([parseInt(props.data.index), 0])} 
                className={`${styles.IconBox} ${isthisplay&&props.isPlaying ? styles.ActiveIconBox : ''}`}
            >
                <PlayButton isthisplay={isthisplay}/>
            </div>
        </div>
    );
}

const mapStateToProps = (state) => {
	return {
		trackData: state.trackData,
		isPlaying: state.isPlaying
	};
};

export default connect(mapStateToProps, { changeTrack })(PlaylistCardG);
